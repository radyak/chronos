<div class="container">

  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a routerLink="../..">Administration</a></li>
    <li class="breadcrumb-item"><a [routerLink]="['..']">Persons</a></li>
    <li class="breadcrumb-item active">{{ breadCrumbTitle() }}</li>
  </ol>

  <h1>
    Administration: {{ pageTitle() }}
  </h1>

  <ng-template #noCurrentEntity>
    <div class="row">
      Loading ...
    </div>
  </ng-template>

  <div class="row" *ngIf="currentEntity else noCurrentEntity">
    <div class="col-8">
      <ng-template [ngIf]="currentEntity">
        <form>
          <fieldset>

            <div class="form-group">
              <label for="entity.key"
                     class="form-label mt-4">
                Key:
              </label>
              <input type="text"
                     class="form-control"
                     id="entity.key"
                     name="entity.key"
                     [(ngModel)]="currentEntity.key">
            </div>

            <div class="form-group">
              <label class="form-label mt-4">
                Dates:
              </label>

                <div class="row">
                  <div class="form-group col-6">
                    <label class="form-label mt-4">
                      From:
                    </label>
                    <chronos-date-input [(date)]="currentEntity.from"></chronos-date-input>
                  </div>

                  <div class="form-group col-6">
                    <label class="form-label mt-4">
                      To:
                    </label>
                    <chronos-date-input [(date)]="currentEntity.to"></chronos-date-input>
                  </div>
                </div>
            </div>

            <div class="form-group">
              <label for="entity.wikiarticle"
                     class="form-label mt-4">
                Linked Wiki Article:
              </label>
              <input type="text"
                     class="form-control"
                     id="entity.wikiarticle"
                     name="entity.wikiarticle"
                     [(ngModel)]="wikipediaSearchTerm"
                     (ngModelChange)="triggerSearch()"/>
                     
              <ng-container *ngFor="let article of matchingArticles; track $index">
                <chronos-wikipedia-article-info [article]="article"
                                                (click)="assignArticleToCurrentEntity(article)"></chronos-wikipedia-article-info>
              </ng-container>
                     
            </div>


          </fieldset>
        </form>
      </ng-template>

    </div>

    <div class="col-4">
      <div *ngIf="wikipediaSummary else noSummary"
           class="form-group">
        <label for="entity.wikipediaPage"
               class="form-label mt-4">
          Wikipedia preview:
        </label>
        <chronos-wikipedia-summary [wikiSummary]="wikipediaSummary">
        </chronos-wikipedia-summary>
      </div>

      <ng-template #noSummary>
        No summary available
      </ng-template>

    </div>
  </div>

  <div class="row">

    <div class="button-group">
      <button type="submit"
              class="btn btn-outline-success"
              (click)="saveEntity()">
        Save
      </button>
      <button type="button"
              class="btn btn-outline-danger"
              (click)="cancelEditEntity()">
        Cancel
      </button>
      <button *ngIf="currentEntity && currentEntity.id"
              type="button"
              class="btn btn-danger"
              (click)="deleteEntity(currentEntity!)">
        Delete
      </button>
    </div>
  </div>

</div>
